<style>
  body { min-height: 1200px; }
  .btn { min-height: 100px; }
</style>

<script>

  function myRound(num, precision) {
    if (num === null) {
      throw "Esperado num";
    }

    if (precision === null) {
      precision = 2;
    }

    return parseFloat((num).toPrecision(precision));
  }

  function playSound(idEl) {
    var element = document.getElementById('item-'+idEl);
    element.volume = 1; // Volume 100%

    if ($('#btn-'+idEl).data('state') === 'stoped') {

      $('#btn-'+idEl).data('state', 'playing');
      element.play();

      var playing = setInterval(function() {

        if (myRound(element.currentTime) === myRound(element.duration)) {

          element.pause();
          element.currentTime = 0;

          $('#btn-'+idEl).data('state', 'stoped');
          $('#btn-'+idEl).addClass('btn-primary').removeClass('btn-warning');

          clearInterval(playing);

        } else {

          // Blink button
          if ($('#btn-'+idEl).hasClass('btn-primary')) {
            $('#btn-'+idEl).removeClass('btn-primary').addClass('btn-warning');
          } else {
            $('#btn-'+idEl).addClass('btn-primary').removeClass('btn-warning');
          }
        }

      }, 300);
    } else {
      element.currentTime = element.duration;
    }

  }
</script>

<div class="row">
  <?php $i=0;?>
  <?php foreach ($sounds as $theme => $files): ?>
    <div class="col-12">
      <h3 class="mt-3"><?php echo $theme; ?></h3>
    </div>

    <?php foreach($files as $filename): $i++ ?>
      <div class="col-2 mt-2">
        <button type="button" class="btn btn-primary btn-block" id="btn-<?php echo $i; ?>" onclick="playSound('<?php echo $i; ?>');" style="white-space: normal;" data-state="stoped">
          <?php echo preg_replace(array('/.+\//', '/\-/'), array('', ' '), $filename); ?>
        </button>

        <audio src="<?php echo $this->baseUrl($soundsPath.$filename); ?>" id="item-<?php echo $i; ?>">
            Your browser does not support the HTML5 Audio element.
        </audio>
      </div>
    <?php endforeach; ?>
  <?php endforeach; ?>
</div>

